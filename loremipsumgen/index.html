<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
        <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QX6N41VY5J"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QX6N41VY5J');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Advanced Lorem Ipsum Generator with custom templates, history, text-to-speech, keyword weighting, and multiple themes.">
    <meta name="keywords" content="Lorem Ipsum, placeholder text, generator, mock text, web design, content">
    <title>Buzz | Advanced Lorem Ipsum Generator</title>
        <link rel="icon" href="/toolshub.ico" type="image/x-icon">
        <link rel="shortcut icon" href="/toolshub.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-bg: #fff;
            --border-color: #e0e0e0;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        [data-theme="dark"] {
            --primary-color: #4895ef;
            --secondary-color: #560bad;
            --text-color: #f8f9fa;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333;
        }

        [data-theme="blue"] {
            --primary-color: #0288d1;
            --secondary-color: #01579b;
            --text-color: #333;
            --bg-color: #e3f2fd;
            --card-bg: #fff;
            --border-color: #b3e5fc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .brand i {
            margin-right: 10px;
            font-size: 1.5rem;
        }

        .header-title {
            font-size: 1.5rem;
            text-align: center;
            flex-grow: 1;
        }

        .home-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: 600;
            transition: all 0.3s;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .home-btn i {
            margin-right: 5px;
        }

        main {
            padding: 2rem 0;
        }

        .hero {
            text-align: center;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .hero p {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto 1.5rem;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .card-title i {
            margin-right: 10px;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="number"],
        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-family: var(--font-main);
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 5px rgba(67, 97, 238, 0.3);
            outline: none;
        }

        input[type="range"] {
            width: 100%;
            margin-top: 5px;
        }

        .range-value {
            display: inline-block;
            width: 40px;
            text-align: center;
            margin-left: 10px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
        }

        .checkbox-item input {
            margin-right: 8px;
            cursor: pointer;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-primary.processing {
            animation: pulse 1.5s infinite ease-in-out;
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .result-container {
            position: relative;
        }

        #generatedText {
            min-height: 200px;
            max-height: 500px;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--card-bg);
            color: var(--text-color);
            white-space: pre-wrap;
            line-height: 1.7;
            resize: vertical;
        }

        .word-count {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .copy-btn,
        .read-aloud-btn,
        .stop-reading-btn {
            position: absolute;
            top: 10px;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            color: var(--text-color);
            transition: all 0.3s;
        }

        .copy-btn {
            right: 10px;
            background: rgba(0, 0, 0, 0.1);
        }

        .copy-btn:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .read-aloud-btn {
            right: 60px;
            background: rgba(0, 128, 0, 0.1);
        }

        .read-aloud-btn:hover {
            background: rgba(0, 128, 0, 0.2);
        }

        .stop-reading-btn {
            right: 110px;
            background: rgba(255, 0, 0, 0.1);
            display: none;
        }

        .stop-reading-btn:hover {
            background: rgba(255, 0, 0, 0.2);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-color);
            margin-left: 15px;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .share-btn {
            padding: 8px 12px;
            border-radius: 5px;
            color: white;
            display: flex;
            align-items: center;
            text-decoration: none;
            font-size: 0.9rem;
            transition: transform 0.3s;
        }

        .share-btn:hover {
            transform: translateY(-2px);
        }

        .twitter {
            background-color: #1DA1F2;
        }

        .facebook {
            background-color: #4267B2;
        }

        .linkedin {
            background-color: #0077B5;
        }

        .whatsapp {
            background-color: #25D366;
        }

        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 99;
        }

        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .scroll-to-top:hover {
            background-color: var(--secondary-color);
            transform: translateY(-5px);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            animation: scaleIn 0.5s ease-out;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite, colorShift 3s linear infinite;
            margin: 0 auto;
        }

        .progress-bar {
            width: 100%;
            height: 5px;
            background-color: var(--border-color);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0;
            animation: progress 0.8s linear forwards;
        }

        @keyframes progress {
            0% { width: 0; }
            100% { width: 100%; }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes colorShift {
            0% { border-left-color: var(--primary-color); }
            50% { border-left-color: var(--secondary-color); }
            100% { border-left-color: var(--primary-color); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes scaleIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes slideIn {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .history-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }

        .history-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .history-item button {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .history-item button:hover {
            text-decoration: underline;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-top: 2rem;
            gap: 15px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            flex: 1;
            min-width: 150px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }

        footer {
            background-color: var(--card-bg);
            padding: 2rem 0;
            text-align: center;
            border-top: 1px solid var(--border-color);
            margin-top: 2rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--primary-color);
        }

        .copyright {
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .brand {
                margin-bottom: 10px;
            }

            .header-title {
                margin-bottom: 15px;
            }

            .home-btn {
                margin-top: 10px;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .range-value {
                margin-left: 0;
                margin-top: 5px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
            }

            .stats {
                flex-direction: column;
            }

            .stat-card {
                margin-bottom: 15px;
            }
        }

        /* Markdown preview styles */
        #markdownPreview {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--card-bg);
            margin-top: 15px;
            display: none;
        }

        #markdownPreview h1, 
        #markdownPreview h2, 
        #markdownPreview h3 {
            color: var(--primary-color);
            margin: 15px 0 10px;
        }

        #markdownPreview p {
            margin-bottom: 10px;
        }

        #markdownPreview ul, 
        #markdownPreview ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        #markdownPreview a {
            color: var(--primary-color);
            text-decoration: none;
        }

        #markdownPreview a:hover {
            text-decoration: underline;
        }

        #markdownPreview code {
            background-color: rgba(0, 0, 0, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        #markdownPreview pre {
            background-color: rgba(0, 0, 0, 0.1);
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }

        #markdownPreview blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 15px;
            margin: 15px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="brand">
                <i class="fas fa-bolt"></i>
                <span>Buzz</span>
            </div>
            <h1 class="header-title">Lorem Ipsum Generator</h1>
            <a href="/" class="home-btn" aria-label="Return to home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h1>Advanced Lorem Ipsum Generator</h1>
            <p>Create tailored placeholder text with custom templates, multiple themes, text-to-speech, keyword weighting, and history tracking.</p>
        </section>

        <section class="card fade-in">
            <h2 class="card-title"><i class="fas fa-sliders-h"></i> Text Configuration</h2>
            
            <div class="form-group">
                <label for="textType">Text Type</label>
                <select id="textType" class="form-control" aria-label="Select text type">
                    <option value="latin">Classic Lorem Ipsum</option>
                    <option value="modern">Modern Corporate</option>
                    <option value="tech">Tech Jargon</option>
                    <option value="medical">Medical Terms</option>
                    <option value="legal">Legal Language</option>
                    <option value="fantasy">Fantasy Theme</option>
                </select>
            </div>

            <div class="form-group">
                <label for="language">Language</label>
                <select id="language" class="form-control" aria-label="Select language">
                    <option value="en">English</option>
                    <option value="la">Latin</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="it">Italian</option>
                    <option value="pt">Portuguese</option>
                    <option value="ru">Russian</option>
                    <option value="zh">Chinese</option>
                    <option value="ja">Japanese</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tone">Tone</label>
                <select id="tone" class="form-control" aria-label="Select tone">
                    <option value="neutral">Neutral</option>
                    <option value="formal">Formal</option>
                    <option value="casual">Casual</option>
                    <option value="humorous">Humorous</option>
                    <option value="academic">Academic</option>
                </select>
            </div>

            <div class="form-group">
                <label for="outputFormat">Output Format</label>
                <select id="outputFormat" class="form-control" aria-label="Select output format">
                    <option value="plain">Plain Text</option>
                    <option value="html">HTML</option>
                    <option value="markdown">Markdown</option>
                </select>
            </div>

            <div class="form-group">
                <label for="length">Length (words): <span id="lengthValue" class="range-value">150</span></label>
                <div class="input-group">
                    <input type="range" id="length" min="10" max="1000" value="150" step="10" aria-label="Adjust text length">
                </div>
            </div>

            <div class="form-group">
                <label>Additional Options</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeLinks" checked aria-label="Include links in text">
                        <label for="includeLinks">Include Links</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeHeadings" checked aria-label="Include headings in text">
                        <label for="includeHeadings">Include Headings</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeLists" aria-label="Include lists in text">
                        <label for="includeLists">Include Lists</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeQuotes" aria-label="Include quotes in text">
                        <label for="includeQuotes">Include Quotes</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeCode" aria-label="Include code snippets in text">
                        <label for="includeCode">Include Code</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="keywords">
                    Keywords (format: keyword1:weight1, keyword2:weight2, e.g., design:0.5, marketing:0.8)
                    <span class="tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Enter keywords with optional weights (0 to 1). Higher weights mean the keyword appears more often.</span>
                    </span>
                </label>
                <input type="text" id="keywords" placeholder="e.g., design:0.5, marketing:0.8" aria-label="Enter keywords with weights">
                <div id="keywordsError" class="error-message">Invalid format. Use keyword:weight (e.g., design:0.5), weights between 0 and 1, or just keywords.</div>
            </div>

            <div class="form-group">
                <label for="customTemplate">Custom Template</label>
                <div class="input-group">
                    <input type="text" id="customTemplateName" placeholder="Template name" aria-label="Enter custom template name">
                    <textarea id="customTemplate" placeholder="Enter your custom text sample" rows="3" aria-label="Enter custom text sample"></textarea>
                </div>
                <div id="templateError" class="error-message">Template name and text must be non-empty.</div>
                <div class="btn-group">
                    <button id="addTemplateBtn" class="btn btn-success" aria-label="Add custom template">
                        <i class="fas fa-plus"></i> Add Template
                    </button>
                    <button id="clearTemplatesBtn" class="btn btn-danger" aria-label="Clear all custom templates">
                        <i class="fas fa-trash"></i> Clear Templates
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="themeSelect">Theme</label>
                <select id="themeSelect" class="form-control" aria-label="Select theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="blue">Blue</option>
                </select>
            </div>

            <div class="btn-group">
                <button id="generateBtn" class="btn btn-primary" aria-label="Generate placeholder text">
                    <i class="fas fa-magic"></i> Generate Text
                </button>
                <button id="resetBtn" class="btn btn-secondary" aria-label="Reset form and stats">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
        </section>

        <div class="loading" id="loadingIndicator" role="status" aria-live="polite">
            <div class="spinner" aria-hidden="true"></div>
            <p>Generating your custom text...</p>
            <div class="progress-bar">
                <div class="progress-bar-fill"></div>
            </div>
        </div>

        <section class="card" id="resultSection" style="display: none;">
            <h2 class="card-title"><i class="fas fa-file-alt"></i> Generated Text</h2>
            
            <div class="form-group">
                <div class="result-container">
                    <textarea id="generatedText" aria-label="Generated placeholder text"></textarea>
                    <button id="copyBtn" class="copy-btn" title="Copy to clipboard" aria-label="Copy generated text to clipboard">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button id="readAloudBtn" class="read-aloud-btn" title="Read aloud" aria-label="Read generated text aloud">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <button id="stopReadingBtn" class="stop-reading-btn" title="Stop reading" aria-label="Stop reading text">
                        <i class="fas fa-stop"></i>
                    </button>
                </div>
                <div id="wordCount" class="word-count">Words: 0</div>
            </div>

            <div class="form-group">
                <label for="voiceSelect">Voice</label>
                <select id="voiceSelect" class="form-control" aria-label="Select voice for text-to-speech"></select>
            </div>

            <div class="form-group">
                <label for="speechSpeed">Speech Speed: <span id="speechSpeedValue" class="range-value">1.0</span>x</label>
                <div class="input-group">
                    <input type="range" id="speechSpeed" min="0.5" max="2" value="1" step="0.1" aria-label="Adjust speech speed">
                </div>
            </div>

            <div id="markdownPreview"></div>

            <div class="form-group">
                <label>Export Options</label>
                <div class="btn-group">
                    <button id="downloadTxt" class="btn btn-secondary" aria-label="Download as TXT">
                        <i class="fas fa-file-alt"></i> TXT
                    </button>
                    <button id="downloadJson" class="btn btn-secondary" aria-label="Download as JSON">
                        <i class="fas fa-file-code"></i> JSON
                    </button>
                    <button id="downloadCsv" class="btn btn-secondary" aria-label="Download as CSV">
                        <i class="fas fa-file-csv"></i> CSV
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label>Share</label>
                <div class="share-buttons">
                    <a href="#" class="share-btn twitter" id="shareTwitter" aria-label="Share on Twitter">
                        <i class="fab fa-twitter"></i> Twitter
                    </a>
                    <a href="#" class="share-btn facebook" id="shareFacebook" aria-label="Share on Facebook">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </a>
                    <a href="#" class="share-btn linkedin" id="shareLinkedin" aria-label="Share on LinkedIn">
                        <i class="fab fa-linkedin-in"></i> LinkedIn
                    </a>
                    <a href="#" class="share-btn whatsapp" id="shareWhatsapp" aria-label="Share on WhatsApp">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                </div>
            </div>

            <div class="form-group">
                <label>Recent Generations</label>
                <ul id="historyList" class="history-list" aria-label="Recent generated texts"></ul>
                <div class="btn-group">
                    <button id="clearHistoryBtn" class="btn btn-danger" aria-label="Clear generation history">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                </div>
            </div>
        </section>

        <section class="card fade-in">
            <h2 class="card-title"><i class="fas fa-chart-line"></i> Usage Statistics</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalGenerations">0</div>
                    <div class="stat-label">Total Generations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="charsGenerated">0</div>
                    <div class="stat-label">Characters Generated</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeUsers">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="popularLanguage">EN</div>
                    <div class="stat-label">Most Popular Language</div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="#">About</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Contact</a>
                <a href="#">API Documentation</a>
            </div>
            <p class="copyright" id="copyright"></p>
        </div>
    </footer>

    <div class="scroll-to-top" id="scrollToTop" aria-label="Scroll to top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // DOM Elements
        const generateBtn = document.getElementById('generateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const copyBtn = document.getElementById('copyBtn');
        const readAloudBtn = document.getElementById('readAloudBtn');
        const stopReadingBtn = document.getElementById('stopReadingBtn');
        const voiceSelect = document.getElementById('voiceSelect');
        const speechSpeed = document.getElementById('speechSpeed');
        const speechSpeedValue = document.getElementById('speechSpeedValue');
        const scrollToTop = document.getElementById('scrollToTop');
        const lengthSlider = document.getElementById('length');
        const lengthValue = document.getElementById('lengthValue');
        const outputFormat = document.getElementById('outputFormat');
        const generatedText = document.getElementById('generatedText');
        const resultSection = document.getElementById('resultSection');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const markdownPreview = document.getElementById('markdownPreview');
        const downloadTxt = document.getElementById('downloadTxt');
        const downloadJson = document.getElementById('downloadJson');
        const downloadCsv = document.getElementById('downloadCsv');
        const shareTwitter = document.getElementById('shareTwitter');
        const shareFacebook = document.getElementById('shareFacebook');
        const shareLinkedin = document.getElementById('shareLinkedin');
        const shareWhatsapp = document.getElementById('shareWhatsapp');
        const textTypeSelect = document.getElementById('textType');
        const customTemplateName = document.getElementById('customTemplateName');
        const customTemplate = document.getElementById('customTemplate');
        const addTemplateBtn = document.getElementById('addTemplateBtn');
        const clearTemplatesBtn = document.getElementById('clearTemplatesBtn');
        const templateError = document.getElementById('templateError');
        const keywordsInput = document.getElementById('keywords');
        const keywordsError = document.getElementById('keywordsError');
        const themeSelect = document.getElementById('themeSelect');
        const wordCountDisplay = document.getElementById('wordCount');
        const historyList = document.getElementById('historyList');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');

        // Text-to-Speech state
        let speechUtterance = null;

        // Sample data for different text types
        const textSamples = {
            latin: {
                en: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                la: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                es: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                fr: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                de: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                ru: "Лорем ипсум долор сит амет, консецтетур адиписицинг элит.",
                zh: "洛雷姆·伊普苏姆·多洛尔·西特·阿梅特，康塞克图尔·阿迪皮辛·埃利特。",
                ja: "ロレム・イプサム・ドロール・シット・アメット、コンセクトゥール・アドピシング・エリート。"
            },
            modern: {
                en: "In today's dynamic business ecosystem, organizations must leverage cross-functional synergies to drive disruptive innovation.",
                es: "En el ecosistema empresarial actual, las organizaciones deben aprovechar las sinergias multifuncionales.",
                fr: "Dans l'écosystème commercial dynamique d'aujourd'hui, les organisations doivent tirer parti des synergies transversales."
            },
            tech: {
                en: "The quantum computing paradigm shift enables exponential processing power through qubit entanglement.",
                es: "El cambio de paradigma de la computación cuántica permite un poder de procesamiento exponencial.",
                fr: "Le changement de paradigme de l'informatique quantique permet une puissance de traitement exponentielle.",
                la: "Computatio quantica paradigma mutatio vim processus exponentialem per qubitum connexionem facit."
            },
            medical: {
                en: "The patient presented with acute onset of dyspnea and was found to have bilateral pulmonary infiltrates.",
                es: "El paciente presentó disnea de inicio agudo y se encontró que tenía infiltrados pulmonares bilaterales.",
                fr: "Le patient a présenté une dyspnée d'apparition aiguë et s'est avéré avoir des infiltrats pulmonaires bilatéraux."
            },
            legal: {
                en: "The party of the first part hereby covenants and agrees to indemnify and hold harmless the party of the second part.",
                es: "La parte de la primera parte por la presente pacta y acuerda indemnizar y eximir de responsabilidad a la parte de la segunda parte.",
                fr: "La partie de la première partie convient par les présentes d'indemniser et de dégager de toute responsabilité la partie de la deuxième partie."
            },
            fantasy: {
                en: "The ancient dragon soared over the misty mountains, its scales glimmering like a thousand stars in the twilight.",
                es: "El antiguo dragón se elevó sobre las montañas brumosas, sus escamas brillando como mil estrellas en el crepúsculo.",
                fr: "L'ancien dragon planait au-dessus des montagnes brumeuses, ses écailles scintillant comme mille étoiles dans le crépusculo."
            }
        };

        // Custom templates storage
        let customTemplates = JSON.parse(localStorage.getItem('customTemplates')) || {};

        // Tone modifiers for different tones and languages
        const toneModifiers = {
            neutral: {
                en: "",
                la: "",
                es: "",
                fr: "",
                de: "",
                it: "",
                pt: "",
                ru: "",
                zh: "",
                ja: ""
            },
            formal: {
                en: "It is imperative to note that ",
                la: "Est imperativum notare quod ",
                es: "Es imperativo señalar que ",
                fr: "Il est impératif de noter que ",
                de: "Es ist zwingend zu beachten, dass ",
                it: "È imperativo notare che ",
                pt: "É imperativo notar que ",
                ru: "Необходимо отметить, что ",
                zh: "必须指出，",
                ja: "次の点を指摘することが重要です："
            },
            casual: {
                en: "So, like, ",
                la: "Sic, quasi, ",
                es: "Así que, como, ",
                fr: "Alors, comme, ",
                de: "Also, wie, ",
                it: "Quindi, tipo, ",
                pt: "Então, tipo, ",
                ru: "Ну, типа, ",
                zh: "所以，就像，",
                ja: "で、みたいな、"
            },
            humorous: {
                en: "In a shocking turn of events that absolutely no one predicted, ",
                la: "In stupendo eventuum cursu quem nemo prorsus praedixit, ",
                es: "En un giro sorprendente de los eventos que absolutamente nadie predijo, ",
                fr: "Dans un tournant choquant des événements que personne n'a prédit, ",
                de: "In einer schockierenden Wendung der Ereignisse, die absolut niemand vorhergesagt hat, ",
                it: "In un sorprendente colpo di scena che assolutamente nessuno ha previsto, ",
                pt: "Numa reviravolta chocante dos eventos que absolutamente ninguém previu, ",
                ru: "В шокирующем повороте событий, который абсолютно никто не предвидел, ",
                zh: "在一个完全无人预料的令人震惊的事件转折中，",
                ja: "誰もが全く予測していなかった衝撃的な出来事の展開で、"
            },
            academic: {
                en: "As evidenced by recent scholarship, ",
                la: "Ut recentibus studiis demonstratum est, ",
                es: "Como lo demuestra la erudición reciente, ",
                fr: "Comme en témoignent les récentes recherches, ",
                de: "Wie jüngste Forschungen belegen, ",
                it: "Come dimostrato dalla recente erudizione, ",
                pt: "Como evidenciado por estudos recentes, ",
                ru: "Как свидетельствуют недавние исследования, ",
                zh: "正如近期学术研究所证明，",
                ja: "最近の学術研究によって証明されているように、"
            }
        };

        // Stats
        let stats = {
            generations: 0,
            chars: 0,
            users: 1254,
            popularLang: 'en'
        };

        // History
        let history = JSON.parse(localStorage.getItem('generationHistory')) || [];

        // Initialize stats, UI, custom templates, and text-to-speech
        function init() {
            lengthValue.textContent = lengthSlider.value;
            speechSpeedValue.textContent = speechSpeed.value;
            
            try {
                const savedStats = localStorage.getItem('loremIpsumStats');
                if (savedStats) {
                    stats = JSON.parse(savedStats);
                    updateStats(0);
                }
            } catch (error) {
                console.error('Failed to load stats from localStorage:', error);
                stats = {
                    generations: 0,
                    chars: 0,
                    users: 1254,
                    popularLang: 'en'
                };
            }
            
            popularLanguage.textContent = stats.popularLang.toUpperCase();
            
            // Set dynamic copyright year
            document.getElementById('copyright').textContent = `© ${new Date().getFullYear()} Buzz Lorem Ipsum Generator. All rights reserved.`;
            
            // Apply saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            themeSelect.value = savedTheme;
            applyTheme(savedTheme);
            
            // Load custom templates
            loadCustomTemplates();
            
            // Load history
            updateHistoryUI();
            
            // Update word count
            updateWordCount();

            // Initialize text-to-speech voices
            populateVoices();
            if (typeof speechSynthesis !== 'undefined') {
                speechSynthesis.onvoiceschanged = populateVoices;
            }
        }

        // Populate voices for text-to-speech
        function populateVoices() {
            const voices = speechSynthesis.getVoices();
            voiceSelect.innerHTML = voices.map((voice, index) => 
                `<option value="${index}">${voice.name} (${voice.lang})</option>`
            ).join('');
        }

        // Apply theme
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        // Update usage statistics
        function updateStats(chars) {
            stats.generations++;
            stats.chars += chars;
            
            totalGenerations.textContent = stats.generations.toLocaleString();
            charsGenerated.textContent = stats.chars.toLocaleString();
            activeUsers.textContent = stats.users.toLocaleString();
            popularLanguage.textContent = stats.popularLang.toUpperCase();
            localStorage.setItem('loremIpsumStats', JSON.stringify(stats));
        }

        // Update word count
        function updateWordCount() {
            const text = generatedText.value.trim();
            const words = text ? text.split(/\s+/).length : 0;
            wordCountDisplay.textContent = `Words: ${words}`;
        }

        // Load custom templates into dropdown
        function loadCustomTemplates() {
            const customOptions = Object.keys(customTemplates).map(name => 
                `<option value="custom_${name}">${name}</option>`
            ).join('');
            textTypeSelect.innerHTML = `
                <option value="latin">Classic Lorem Ipsum</option>
                <option value="modern">Modern Corporate</option>
                <option value="tech">Tech Jargon</option>
                <option value="medical">Medical Terms</option>
                <option value="legal">Legal Language</option>
                <option value="fantasy">Fantasy Theme</option>
                ${customOptions}
            `;
        }

        // Validate input
        function validateInput(value, type) {
            if (!value.trim()) return false;
            if (type === 'keywords') {
                // Allow format: keyword:weight, keyword:weight or just keyword, keyword
                const pairs = value.split(',').map(pair => pair.trim());
                for (let pair of pairs) {
                    if (pair.includes(':')) {
                        const [keyword, weight] = pair.split(':').map(item => item.trim());
                        if (!keyword || isNaN(weight) || weight < 0 || weight > 1) {
                            return false;
                        }
                        if (!/^[a-zA-Z0-9\s]+$/.test(keyword)) {
                            return false;
                        }
                    } else {
                        if (!/^[a-zA-Z0-9\s]+$/.test(pair)) {
                            return false;
                        }
                    }
                }
                return true;
            }
            return true;
        }

        // Parse keywords with weights
        function parseKeywords(input) {
            const pairs = input.split(',').map(pair => pair.trim());
            const keywords = [];
            const weights = [];
            let totalWeight = 0;

            for (let pair of pairs) {
                if (pair.includes(':')) {
                    const [keyword, weight] = pair.split(':').map(item => item.trim());
                    const parsedWeight = parseFloat(weight);
                    keywords.push(keyword);
                    weights.push(parsedWeight);
                    totalWeight += parsedWeight;
                } else {
                    keywords.push(pair);
                    weights.push(1); // Default weight
                    totalWeight += 1;
                }
            }

            // Normalize weights to sum to 1
            if (totalWeight > 0) {
                for (let i = 0; i < weights.length; i++) {
                    weights[i] = weights[i] / totalWeight;
                }
            }

            return { keywords, weights };
        }

        // Weighted random selection
        function weightedRandomSelect(items, weights) {
            const rand = Math.random();
            let cumulative = 0;
            for (let i = 0; i < weights.length; i++) {
                cumulative += weights[i];
                if (rand <= cumulative) {
                    return items[i];
                }
            }
            return items[items.length - 1]; // Fallback
        }

        // Update history UI
        function updateHistoryUI() {
            historyList.innerHTML = history.map((item, index) => `
                <li class="history-item">
                    <span>${item.snippet} (${item.timestamp})</span>
                    <button onclick="restoreHistory(${index})" aria-label="Restore text from history">Restore</button>
                </li>
            `).join('');
        }

        // Restore history item
        function restoreHistory(index) {
            const item = history[index];
            generatedText.value = item.text;
            outputFormat.value = item.format;
            updatePreview();
            updateWordCount();
            resultSection.style.display = 'block';
            resultSection.classList.add('slide-in');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Clear history
        function clearHistory() {
            if (confirm('Are you sure you want to clear the generation history?')) {
                history = [];
                localStorage.setItem('generationHistory', JSON.stringify(history));
                updateHistoryUI();
            }
        }

        // Event listeners
        lengthSlider.addEventListener('input', function() {
            lengthValue.textContent = this.value;
        });

        speechSpeed.addEventListener('input', function() {
            speechSpeedValue.textContent = `${this.value}x`;
        });

        generateBtn.addEventListener('click', generateText);
        resetBtn.addEventListener('click', resetForm);
        copyBtn.addEventListener('click', copyToClipboard);
        readAloudBtn.addEventListener('click', readAloud);
        stopReadingBtn.addEventListener('click', stopReading);
        outputFormat.addEventListener('change', updatePreview);
        generatedText.addEventListener('input', updateWordCount);
        
        downloadTxt.addEventListener('click', () => downloadFile('txt'));
        downloadJson.addEventListener('click', () => downloadFile('json'));
        downloadCsv.addEventListener('click', () => downloadFile('csv'));
        
        shareTwitter.addEventListener('click', shareOnTwitter);
        shareFacebook.addEventListener('click', shareOnFacebook);
        shareLinkedin.addEventListener('click', shareOnLinkedIn);
        shareWhatsapp.addEventListener('click', shareOnWhatsApp);

        addTemplateBtn.addEventListener('click', function() {
            const name = customTemplateName.value.trim();
            const text = customTemplate.value.trim();
            
            if (!validateInput(name, 'template') || !validateInput(text, 'template')) {
                templateError.style.display = 'block';
                return;
            }
            
            templateError.style.display = 'none';
            customTemplates[name] = { en: text };
            localStorage.setItem('customTemplates', JSON.stringify(customTemplates));
            loadCustomTemplates();
            customTemplateName.value = '';
            customTemplate.value = '';
        });

        clearTemplatesBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all custom templates?')) {
                customTemplates = {};
                localStorage.setItem('customTemplates', JSON.stringify(customTemplates));
                loadCustomTemplates();
            }
        });

        keywordsInput.addEventListener('input', function() {
            if (!validateInput(this.value, 'keywords') && this.value) {
                keywordsError.style.display = 'block';
            } else {
                keywordsError.style.display = 'none';
            }
        });

        themeSelect.addEventListener('change', function() {
            applyTheme(this.value);
        });

        clearHistoryBtn.addEventListener('click', clearHistory);

        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                scrollToTop.classList.add('visible');
            } else {
                scrollToTop.classList.remove('visible');
            }
        });

        scrollToTop.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Generate text based on user inputs
        function generateText() {
            const keywordsRaw = keywordsInput.value;
            if (keywordsRaw && !validateInput(keywordsRaw, 'keywords')) {
                keywordsError.style.display = 'block';
                return;
            }
            keywordsError.style.display = 'none';

            // Start processing animations
            generateBtn.classList.add('processing');
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
            generateBtn.setAttribute('aria-busy', 'true');
            loadingIndicator.style.display = 'block';
            resultSection.style.display = 'none';
            
            setTimeout(() => {
                const textType = document.getElementById('textType').value;
                const language = document.getElementById('language').value;
                const tone = document.getElementById('tone').value;
                const length = parseInt(lengthSlider.value);
                const format = outputFormat.value;
                const includeLinks = document.getElementById('includeLinks').checked;
                const includeHeadings = document.getElementById('includeHeadings').checked;
                const includeLists = document.getElementById('includeLists').checked;
                const includeQuotes = document.getElementById('includeQuotes').checked;
                const includeCode = document.getElementById('includeCode').checked;
                const { keywords, weights } = keywordsRaw ? parseKeywords(keywordsRaw) : { keywords: [], weights: [] };
                
                let baseText;
                if (textType.startsWith('custom_')) {
                    const templateName = textType.replace('custom_', '');
                    baseText = customTemplates[templateName]?.[language] || customTemplates[templateName]?.['en'];
                } else {
                    baseText = textSamples[textType]?.[language] || textSamples[textType]?.['en'] || textSamples['latin']['en'];
                }
                
                if (!textSamples[textType]?.[language] && !textType.startsWith('custom_')) {
                    console.warn(`No sample text for ${textType} in ${language}, falling back to English or custom template.`);
                }
                
                const tonePrefix = toneModifiers[tone]?.[language] || toneModifiers[tone]?.['en'] || '';
                
                stats.popularLang = language;
                
                let result = '';
                let wordCount = 0;
                const paragraphs = Math.max(1, Math.floor(length / 50));
                
                for (let p = 0; p < paragraphs; p++) {
                    if (format === 'html') {
                        result += includeHeadings && p === 0 ? '<h1>Sample Heading</h1>\n' : '';
                        result += '<p>';
                    } else if (format === 'markdown' && includeHeadings && p === 0) {
                        result += '# Sample Heading\n\n';
                    }
                    
                    if (p % 3 === 0) {
                        result += tonePrefix;
                        wordCount += tonePrefix.split(' ').length;
                    }
                    
                    const paragraphLength = Math.min(length - wordCount, Math.floor(length / paragraphs));
                    let paragraphText = generateParagraph(baseText, paragraphLength, keywords, weights);
                    
                    if (includeLinks) {
                        paragraphText = addLinks(paragraphText, format);
                    }
                    if (includeLists && p % 2 === 1) {
                        paragraphText = convertToList(paragraphText, format);
                    }
                    if (includeQuotes && p % 3 === 2) {
                        paragraphText = addQuote(paragraphText, format);
                    }
                    if (includeCode && p % 4 === 3) {
                        paragraphText = addCode(paragraphText, format);
                    }
                    
                    result += paragraphText;
                    wordCount += paragraphText.split(' ').length;
                    
                    if (format === 'html') {
                        result += '</p>\n\n';
                    } else {
                        result += '\n\n';
                    }
                }
                
                let words = result.split(' ');
                if (words.length > length) {
                    let trimmed = words.slice(0, length).join(' ');
                    const lastPeriod = trimmed.lastIndexOf('.');
                    if (lastPeriod > -1) {
                        trimmed = trimmed.substring(0, lastPeriod + 1);
                    }
                    result = trimmed;
                    wordCount = result.split(' ').length;
                }
                
                if (format === 'html') {
                    result = result.trim();
                } else if (format === 'markdown') {
                    result = result.trim();
                    try {
                        markdownPreview.innerHTML = marked.parse(result);
                        markdownPreview.style.display = 'block';
                    } catch (error) {
                        console.error('Markdown parsing error:', error);
                        markdownPreview.innerHTML = '<p>Error rendering Markdown preview.</p>';
                        markdownPreview.style.display = 'block';
                    }
                } else {
                    result = result.trim();
                    markdownPreview.style.display = 'none';
                }
                
                generatedText.value = result;
                
                // Save to history with truncated text to reduce storage
                const snippet = result.substring(0, 50) + (result.length > 50 ? '...' : '');
                const historyItem = {
                    text: result,
                    snippet: snippet,
                    format: format,
                    timestamp: new Date().toLocaleString()
                };
                history.unshift(historyItem);
                if (history.length > 5) history.pop();
                
                try {
                    localStorage.setItem('generationHistory', JSON.stringify(history));
                } catch (e) {
                    if (e instanceof DOMException && e.name === 'QuotaExceededError') {
                        console.warn('Storage quota exceeded. Trimming history.');
                        history.pop();
                        try {
                            localStorage.setItem('generationHistory', JSON.stringify(history));
                        } catch (e2) {
                            console.error('Failed to save history after trimming:', e2);
                            alert('Storage quota exceeded. Please clear history or reduce usage.');
                        }
                    } else {
                        console.error('Unexpected error saving history:', e);
                    }
                }
                updateHistoryUI();
                
                // Reset animations
                generateBtn.classList.remove('processing');
                generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Text';
                generateBtn.removeAttribute('aria-busy');
                loadingIndicator.style.display = 'none';
                resultSection.style.display = 'block';
                resultSection.classList.remove('fade-in');
                resultSection.classList.add('slide-in');
                
                updateStats(result.length);
                updateWordCount();
                
                resultSection.scrollIntoView({ behavior: 'smooth' });
                generateBtn.focus();
            }, 800);
        }

        // Generate a single paragraph with weighted keywords
        function generateParagraph(baseText, length, keywords, weights) {
            let words = baseText.split(' ');
            let result = [];
            let iterations = 0;
            const maxIterations = length * 10;
            
            const variations = [
                "However, it's important to consider alternative approaches.",
                "This demonstrates the fundamental principles at work.",
                "Recent developments have challenged traditional assumptions.",
                "The implications of these findings are far-reaching.",
                "Further research is needed to confirm these observations."
            ];
            
            if (keywords.length > 0 && Math.random() > 0.3) {
                const keyword = weightedRandomSelect(keywords, weights);
                result.push(keyword.charAt(0).toUpperCase() + keyword.slice(1));
            }
            
            while (result.length < length && iterations < maxIterations) {
                const randomIndex = Math.floor(Math.random() * words.length);
                let word = words[randomIndex];
                
                if (result.length === 0 || result[result.length-1].endsWith('.')) {
                    word = word.charAt(0).toUpperCase() + word.slice(1);
                }
                
                result.push(word);
                
                if (Math.random() > 0.9 && result.length < length - 10) {
                    const variation = variations[Math.floor(Math.random() * variations.length)];
                    result.push(...variation.split(' '));
                }
                
                if (keywords.length > 0 && Math.random() > 0.7 && result.length < length - 1) {
                    const keyword = weightedRandomSelect(keywords, weights);
                    result.push(keyword);
                }
                
                iterations++;
            }
            
            if (result.length > 0 && !result[result.length-1].endsWith('.')) {
                result[result.length-1] += '.';
            }
            
            return result.join(' ').replace(/\s*\.\s*/g, '. ');
        }

        // Add links to text
        function addLinks(text, format) {
            const words = text.split(' ');
            const linkWords = words.filter(w => w.length > 5 && !w.includes('.'));
            
            if (linkWords.length < 2) return text;
            
            const linkIndex1 = words.indexOf(linkWords[0]);
            const linkIndex2 = words.indexOf(linkWords[Math.min(1, linkWords.length-1)]);
            
            if (linkIndex1 === -1 || linkIndex2 === -1) return text;
            
            if (format === 'html') {
                words[linkIndex1] = `<a href="https://example.com" title="Example link">${words[linkIndex1]}</a>`;
                words[linkIndex2] = `<a href="https://example.org" title="Another example">${words[linkIndex2]}</a>`;
            } else if (format === 'markdown') {
                words[linkIndex1] = `[${words[linkIndex1]}](https://example.com)`;
                words[linkIndex2] = `[${words[linkIndex2]}](https://example.org)`;
            } else {
                words[linkIndex1] = `${words[linkIndex1]} (https://example.com)`;
                words[linkIndex2] = `${words[linkIndex2]} (https://example.org)`;
            }
            
            return words.join(' ');
        }

        // Convert text to a list
        function convertToList(text, format) {
            const sentences = text.split(/[.!?]\s+/).filter(s => s.trim());
            if (sentences.length < 2) return text;
            
            const listItems = sentences.slice(0, Math.min(5, sentences.length));
            
            if (format === 'html') {
                return `<ul>\n${listItems.map(item => `  <li>${item}</li>`).join('\n')}\n</ul>`;
            } else if (format === 'markdown') {
                return listItems.map(item => `- ${item}`).join('\n');
            } else {
                return listItems.map((item, i) => `${i+1}. ${item}`).join('\n');
            }
        }

        // Add a quote to text
        function addQuote(text, format) {
            const language = document.getElementById('language').value;
            const quotes = {
                en: "This is a sample quote to demonstrate functionality.",
                es: "Esta es una cita de muestra para demostrar funcionalidad.",
                fr: "Ceci est une citation d'exemple pour démontrer la fonctionnalité."
            };
            const quote = quotes[language] || quotes.en;
            
            if (format === 'html') {
                return `<blockquote>${quote.replace(/</g, '<')}</blockquote>\n\n${text}`;
            } else if (format === 'markdown') {
                return `> ${quote.replace(/</g, '<')}\n\n${text}`;
            } else {
                return `"${quote.replace(/</g, '<')}"\n\n${text}`;
            }
        }

        // Add code snippet to text
        function addCode(text, format) {
            const code = `function example() {\n  return 'This is sample code';\n}`.replace(/</g, '<');
            
            if (format === 'html') {
                return `<pre><code>${code}</code></pre>\n\n${text}`;
            } else if (format === 'markdown') {
                return "```javascript\n" + code + "\n```\n\n" + text;
            } else {
                return code + "\n\n" + text;
            }
        }

        // Text-to-Speech: Read aloud the generated text
        function readAloud() {
            if (!generatedText.value) {
                alert('No text to read. Please generate text first.');
                return;
            }

            if (speechUtterance) {
                speechSynthesis.cancel();
            }

            const text = generatedText.value;
            speechUtterance = new SpeechSynthesisUtterance(text);

            const voices = speechSynthesis.getVoices();
            const selectedVoiceIndex = parseInt(voiceSelect.value);
            speechUtterance.voice = voices[selectedVoiceIndex];
            speechUtterance.rate = parseFloat(speechSpeed.value);
            speechUtterance.lang = document.getElementById('language').value;

            speechSynthesis.speak(speechUtterance);

            stopReadingBtn.style.display = 'block';
            readAloudBtn.style.display = 'none';

            speechUtterance.onend = () => {
                stopReadingBtn.style.display = 'none';
                readAloudBtn.style.display = 'block';
                speechUtterance = null;
            };

            speechUtterance.onerror = (event) => {
                console.error('Speech synthesis error:', event.error);
                stopReadingBtn.style.display = 'none';
                readAloudBtn.style.display = 'block';
                speechUtterance = null;
                alert('An error occurred during speech synthesis: ' + event.error);
            };
        }

        // Text-to-Speech: Stop reading
        function stopReading() {
            if (speechUtterance) {
                speechSynthesis.cancel();
                stopReadingBtn.style.display = 'none';
                readAloudBtn.style.display = 'block';
                speechUtterance = null;
            }
        }

        // Reset form and stats
        function resetForm() {
            if (confirm('Are you sure you want to reset all settings and stats?')) {
                stopReading();
                document.getElementById('textType').value = 'latin';
                document.getElementById('language').value = 'en';
                document.getElementById('tone').value = 'neutral';
                document.getElementById('outputFormat').value = 'plain';
                document.getElementById('length').value = 150;
                lengthValue.textContent = '150';
                document.getElementById('includeLinks').checked = true;
                document.getElementById('includeHeadings').checked = true;
                document.getElementById('includeLists').checked = false;
                document.getElementById('includeQuotes').checked = false;
                document.getElementById('includeCode').checked = false;
                document.getElementById('keywords').value = '';
                generatedText.value = '';
                markdownPreview.innerHTML = '';
                markdownPreview.style.display = 'none';
                resultSection.style.display = 'none';
                customTemplateName.value = '';
                customTemplate.value = '';
                themeSelect.value = 'light';
                speechSpeed.value = 1;
                speechSpeedValue.textContent = '1.0x';
                applyTheme('light');
                
                stats = {
                    generations: 0,
                    chars: 0,
                    users: 1254,
                    popularLang: 'en'
                };
                history = [];
                updateStats(0);
                updateHistoryUI();
                localStorage.setItem('loremIpsumStats', JSON.stringify(stats));
                localStorage.setItem('generationHistory', JSON.stringify(history));
                updateWordCount();
            }
        }

        // Copy text to clipboard
        function copyToClipboard() {
            const originalText = copyBtn.innerHTML;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(generatedText.value)
                    .then(() => {
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Clipboard API failed:', err);
                        fallbackCopy();
                    });
            } else {
                fallbackCopy();
            }
            
            function fallbackCopy() {
                generatedText.select();
                try {
                    document.execCommand('copy');
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                    }, 2000);
                } catch (err) {
                    console.error('Fallback copy failed:', err);
                    copyBtn.innerHTML = '<i class="fas fa-times"></i> Failed!';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                    }, 2000);
                }
            }
        }

        // Update Markdown preview
        function updatePreview() {
            if (outputFormat.value === 'markdown' && generatedText.value) {
                try {
                    markdownPreview.innerHTML = marked.parse(generatedText.value);
                    markdownPreview.style.display = 'block';
                } catch (error) {
                    console.error('Markdown parsing error:', error);
                    markdownPreview.innerHTML = '<p>Error rendering Markdown preview.</p>';
                    markdownPreview.style.display = 'block';
                }
            } else {
                markdownPreview.innerHTML = '';
                markdownPreview.style.display = 'none';
            }
        }

        // Download generated text
        function downloadFile(type) {
            if (!generatedText.value) {
                alert('No text to download. Please generate text first.');
                return;
            }
            
            let content, mimeType, extension;
            const filename = 'lorem-ipsum';
            
            if (type === 'json') {
                content = JSON.stringify({
                    text: generatedText.value,
                    metadata: {
                        generatedAt: new Date().toISOString(),
                        length: generatedText.value.length,
                        words: generatedText.value.split(' ').length
                    }
                }, null, 2);
                mimeType = 'application/json';
                extension = 'json';
            } else if (type === 'csv') {
                const escapeCsv = (str) => `"${str.replace(/"/g, '""').replace(/\n/g, ' ')}"`;
                content = `"Text","Length","Words"\n${escapeCsv(generatedText.value)},${generatedText.value.length},${generatedText.value.split(' ').length}`;
                mimeType = 'text/csv';
                extension = 'csv';
            } else {
                content = generatedText.value;
                mimeType = 'text/plain';
                extension = 'txt';
            }
            
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.${extension}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Share functions
        function shareOnTwitter() {
            const snippet = generatedText.value ? generatedText.value.substring(0, 100) + '...' : 'Lorem Ipsum text';
            const text = encodeURIComponent(`Check out this Lorem Ipsum text I generated: ${snippet}`);
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }

        function shareOnFacebook() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }

        function shareOnLinkedIn() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('Advanced Lorem Ipsum Generator');
            window.open(`https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${title}`, '_blank');
        }

        function shareOnWhatsApp() {
            const snippet = generatedText.value ? generatedText.value.substring(0, 100) + '...' : 'Lorem Ipsum text';
            const text = encodeURIComponent(`Check out this Lorem Ipsum text I generated: ${snippet} ${window.location.href}`);
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }

        // Initialize the application
        init();
    </script>
</body>
</html>
