<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
        <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QX6N41VY5J"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QX6N41VY5J');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free online tool to securely encrypt and decrypt files using AES-256 encryption. Protect your files with client-side processing that never leaves your browser.">
    <meta name="keywords" content="file encryption, file decryption, AES-256, secure file sharing, online encryptor, client-side encryption">
    <title>Buzz | Secure File Encryptor Decryptor</title>
        <link rel="icon" href="/toolshub.ico" type="image/x-icon">
        <link rel="shortcut icon" href="/toolshub.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4bb543;
            --error-color: #ff3333;
            --warning-color: #ffcc00;
        }

        .dark-theme {
            --primary-color: #7209b7;
            --secondary-color: #560bad;
            --accent-color: #480ca8;
            --light-color: #212529;
            --dark-color: #f8f9fa;
            --success-color: #3a8c3a;
            --error-color: #cc0000;
            --warning-color: #e6b800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--light-color);
            color: var(--dark-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 100;
        }

        .brand {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .brand i {
            margin-right: 0.5rem;
            color: #f72585;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 600;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .nav-button {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            transition: background-color 0.3s;
        }

        .nav-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .nav-button i {
            margin-right: 0.5rem;
        }

        main {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .hero {
            text-align: center;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .hero p {
            font-size: 1.1rem;
            color: var(--dark-color);
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 1.5rem;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .dark-theme .card {
            background-color: #2d2d2d;
        }

        .card h2 {
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .card h2 i {
            margin-right: 0.8rem;
        }

        .file-drop-area {
            border: 2px dashed var(--primary-color);
            border-radius: 8px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            margin-bottom: 1.5rem;
            transition: background-color 0.3s;
        }

        .file-drop-area:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }

        .dark-theme .file-drop-area:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .file-drop-area.active {
            background-color: rgba(67, 97, 238, 0.1);
            border-color: var(--accent-color);
        }

        .file-drop-area i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .file-drop-area p {
            margin-bottom: 0.5rem;
        }

        .file-input {
            display: none;
        }

        .file-info {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 4px;
        }

        .file-info.show {
            display: block;
        }

        .key-section {
            margin-top: 2rem;
        }

        .key-input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 1rem;
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .key-strength {
            height: 5px;
            background: #ddd;
            border-radius: 3px;
            margin-top: 5px;
        }

        .key-strength.weak { background: var(--error-color); }
        .key-strength.medium { background: var(--warning-color); }
        .key-strength.strong { background: var(--success-color); }

        .key-options {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s, transform 0.2s;
            display: inline-flex;
            align-items: center;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn i {
            margin-right: 0.5rem;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #3a8c3a;
        }

        .btn-danger {
            background-color: var(--error-color);
        }

        .btn-danger:hover {
            background-color: #cc0000;
        }

        .progress-container {
            width: 100%;
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin: 1.5rem 0;
            overflow: hidden;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            width: 0%;
            transition: width 0.3s;
        }

        .result-section {
            display: none;
            margin-top: 2rem;
            text-align: center;
        }

        .result-section.show {
            display: block;
        }

        .alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .alert-success {
            background-color: rgba(75, 181, 67, 0.2);
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
        }

        .alert-error {
            background-color: rgba(255, 51, 51, 0.2);
            border-left: 4px solid var(--error-color);
            color: var(--error-color);
        }

        .alert i {
            margin-right: 0.8rem;
            font-size: 1.2rem;
        }

        .instructions {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 8px;
        }

        .instructions h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .instructions ol {
            padding-left: 1.5rem;
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
            margin-left: 0.5rem;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-color);
            color: var(--light-color);
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background-color: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .feature-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .dark-theme .feature-card {
            background-color: #2d2d2d;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        footer {
            background-color: var(--dark-color);
            color: var(--light-color);
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 1rem;
                text-align: center;
            }

            .brand {
                margin-bottom: 0.5rem;
            }

            .app-title {
                position: static;
                transform: none;
                margin: 0.5rem 0;
            }

            .nav-button {
                margin-top: 0.5rem;
            }

            main {
                padding: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .key-options {
                flex-direction: column;
                gap: 0.5rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="brand">
            <i class="fas fa-lock"></i> Buzz
        </div>
        <div class="app-title">File Encryptor Decryptor</div>
        <a href="/" class="nav-button" aria-label="Go to home page">
            <i class="fas fa-home"></i> Home
        </a>
    </header>

    <main>
        <section class="hero">
            <h1>Secure File Encryption Tool</h1>
            <p>Protect your sensitive files with military-grade AES-256 encryption. All processing happens in your browser - your files never leave your device.</p>
        </section>

        <div class="card">
            <h2><i class="fas fa-file-import"></i> File Encryption</h2>
            <div class="file-drop-area" id="encryptDropArea" role="button" aria-label="Upload files for encryption" tabindex="0">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & drop files here or click to browse</p>
                <p class="small">Supports multiple files (PDF, images, documents, etc.)</p>
                <input type="file" id="encryptFileInput" class="file-input" multiple aria-hidden="true">
            </div>
            <div class="file-info" id="encryptFileInfo"></div>

            <div class="key-section">
                <label for="encryptKey">Encryption Key:</label>
                <div class="tooltip">
                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                    <span class="tooltiptext">Use a strong password (min 8 characters) or generate one. You'll need this key to decrypt the files.</span>
                </div>
                <input type="password" id="encryptKey" class="key-input" placeholder="Enter a strong password or generate one below" aria-describedby="keyStrength">
                <div class="key-strength" id="keyStrength"></div>
                <div class="key-options">
                    <button id="generateKeyBtn" class="btn btn-secondary" aria-label="Generate strong encryption key">
                        <i class="fas fa-key"></i> Generate Strong Key
                    </button>
                    <button id="copyEncryptKeyBtn" class="btn btn-secondary" aria-label="Copy encryption key to clipboard">
                        <i class="fas fa-copy"></i> Copy Key
                    </button>
                    <button id="toggleKeyVisibility" class="btn btn-secondary" aria-label="Toggle key visibility">
                        <i class="fas fa-eye"></i> Show Key
                    </button>
                </div>
                <button id="encryptBtn" class="btn btn-success" disabled aria-label="Encrypt selected files">
                    <i class="fas fa-lock"></i> Encrypt Files
                </button>
            </div>

            <div class="progress-container" id="encryptProgressContainer">
                <div class="progress-bar" id="encryptProgressBar"></div>
            </div>

            <div class="result-section" id="encryptResult">
                <div class="alert alert-success" role="alert">
                    <i class="fas fa-check-circle"></i>
                    <span id="encryptSuccessMsg">Files encrypted successfully!</span>
                </div>
                <button id="downloadEncryptedBtn" class="btn" aria-label="Download encrypted files as ZIP">
                    <i class="fas fa-download"></i> Download Encrypted Files
                </button>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-file-export"></i> File Decryption</h2>
            <div class="file-drop-area" id="decryptDropArea" role="button" aria-label="Upload file for decryption" tabindex="0">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & drop encrypted file here or click to browse</p>
                <p class="small">File must have been encrypted with this tool</p>
                <input type="file" id="decryptFileInput" class="file-input" aria-hidden="true">
            </div>
            <div class="file-info" id="decryptFileInfo"></div>

            <div class="key-section">
                <label for="decryptKey">Decryption Key:</label>
                <input type="text" id="decryptKey" class="key-input" placeholder="Enter the key used to encrypt this file" aria-describedby="decryptKeyHelp">
                <button id="decryptBtn" class="btn btn-success" disabled aria-label="Decrypt selected file">
                    <i class="fas fa-unlock"></i> Decrypt File
                </button>
            </div>

            <div class="progress-container" id="decryptProgressContainer">
                <div class="progress-bar" id="decryptProgressBar"></div>
            </div>

            <div class="result-section" id="decryptResult">
                <div class="alert alert-success" id="decryptSuccessAlert" role="alert">
                    <i class="fas fa-check-circle"></i>
                    <span id="decryptSuccessMsg">File decrypted successfully!</span>
                </div>
                <div class="alert alert-error" id="decryptErrorAlert" style="display: none;" role="alert">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="decryptErrorMsg">Incorrect key or corrupted file</span>
                </div>
                <button id="downloadDecryptedBtn" class="btn" aria-label="Download decrypted file">
                    <i class="fas fa-download"></i> Download Decrypted File
                </button>
            </div>
        </div>

        <div class="instructions">
            <h3>How to use this tool:</h3>
            <ol>
                <li><strong>For Encryption:</strong> Upload one or more files, set a strong password (or generate one), then click "Encrypt Files". Download the encrypted files as a ZIP and save your password.</li>
                <li><strong>For Decryption:</strong> Upload an encrypted file, enter the exact password used during encryption, then click "Decrypt File".</li>
                <li>Always keep your encryption key safe - without it, your files cannot be recovered.</li>
                <li>For maximum security, use a password manager to store your encryption keys.</li>
            </ol>
        </div>

        <div class="features">
            <div class="feature-card">
                <i class="fas fa-shield-alt"></i>
                <h3>Military-Grade Security</h3>
                <p>Uses AES-256 encryption, the same standard used by governments and security experts worldwide.</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-user-secret"></i>
                <h3>Zero Knowledge</h3>
                <p>All processing happens in your browser. Your files never touch our servers.</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-bolt"></i>
                <h3>Lightning Fast</h3>
                <p>Optimized algorithms provide quick encryption/decryption even for large files.</p>
            </div>
        </div>
    </main>

    <div class="theme-toggle" id="themeToggle" role="button" aria-label="Toggle dark/light theme">
        <i class="fas fa-moon"></i>
    </div>

    <footer>
        <p>Â© 2025 Buzz Security Tools. All rights reserved.</p>
        <p>This tool is provided free of charge for personal and business use.</p>
    </footer>

    <div class="alert-container" id="alertContainer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // DOM Elements
        const encryptDropArea = document.getElementById('encryptDropArea');
        const encryptFileInput = document.getElementById('encryptFileInput');
        const encryptFileInfo = document.getElementById('encryptFileInfo');
        const encryptKey = document.getElementById('encryptKey');
        const keyStrength = document.getElementById('keyStrength');
        const generateKeyBtn = document.getElementById('generateKeyBtn');
        const copyEncryptKeyBtn = document.getElementById('copyEncryptKeyBtn');
        const toggleKeyVisibility = document.getElementById('toggleKeyVisibility');
        const encryptBtn = document.getElementById('encryptBtn');
        const encryptProgressContainer = document.getElementById('encryptProgressContainer');
        const encryptProgressBar = document.getElementById('encryptProgressBar');
        const encryptResult = document.getElementById('encryptResult');
        const downloadEncryptedBtn = document.getElementById('downloadEncryptedBtn');

        const decryptDropArea = document.getElementById('decryptDropArea');
        const decryptFileInput = document.getElementById('decryptFileInput');
        const decryptFileInfo = document.getElementById('decryptFileInfo');
        const decryptKey = document.getElementById('decryptKey');
        const decryptBtn = document.getElementById('decryptBtn');
        const decryptProgressContainer = document.getElementById('decryptProgressContainer');
        const decryptProgressBar = document.getElementById('decryptProgressBar');
        const decryptResult = document.getElementById('decryptResult');
        const decryptSuccessAlert = document.getElementById('decryptSuccessAlert');
        const decryptErrorAlert = document.getElementById('decryptErrorAlert');
        const downloadDecryptedBtn = document.getElementById('downloadDecryptedBtn');

        const themeToggle = document.getElementById('themeToggle');
        const alertContainer = document.getElementById('alertContainer');

        // Global variables
        let encryptFiles = [];
        let encryptedBlobs = [];
        let decryptFile = null;
        let decryptedBlob = null;
        const CHUNK_SIZE = 1024 * 1024; // 1MB chunks
        const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100MB

        // Initialize Web Worker
        const worker = new Worker(URL.createObjectURL(new Blob([`
            self.importScripts('https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js');

            self.onmessage = async function(e) {
                const { fileData, key, action, mimeType, fileName } = e.data;
                try {
                    if (action === 'encrypt') {
                        const wordArray = CryptoJS.lib.WordArray.create(fileData);
                        const encrypted = CryptoJS.AES.encrypt(wordArray, key, {
                            mode: CryptoJS.mode.CBC,
                            padding: CryptoJS.pad.Pkcs7
                        }).toString();
                        const metadata = JSON.stringify({ mimeType, fileName });
                        const result = btoa(metadata) + '|' + encrypted;
                        self.postMessage({ result, fileName });
                    } else if (action === 'decrypt') {
                        // Validate file format
                        if (typeof fileData !== 'string' || !fileData.includes('|')) {
                            throw new Error('Invalid encrypted file format. File must be encrypted with this tool.');
                        }

                        const [metadataB64, encryptedData] = fileData.split('|');
                        let metadata;
                        try {
                            metadata = JSON.parse(atob(metadataB64));
                        } catch (err) {
                            throw new Error('Invalid metadata in encrypted file. File may be corrupted.');
                        }

                        const decrypted = CryptoJS.AES.decrypt(encryptedData, key, {
                            mode: CryptoJS.mode.CBC,
                            padding: CryptoJS.pad.Pkcs7
                        });

                        if (!decrypted || !decrypted.sigBytes || decrypted.sigBytes <= 0) {
                            throw new Error('Decryption failed: Incorrect key or corrupted file.');
                        }

                        // Convert decrypted WordArray to Uint8Array for binary data
                        const byteArray = new Uint8Array(decrypted.sigBytes);
                        for (let i = 0; i < decrypted.sigBytes; i++) {
                            const byte = decrypted.words[i >>> 2] >>> (24 - (i % 4) * 8) & 0xff;
                            byteArray[i] = byte;
                        }

                        self.postMessage({
                            result: byteArray,
                            mimeType: metadata.mimeType || 'application/octet-stream',
                            fileName: metadata.fileName
                        });
                    }
                } catch (error) {
                    self.postMessage({ error: error.message, fileName });
                }
            };
        `], { type: 'application/javascript' })));

        // Theme toggle
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            const icon = themeToggle.querySelector('i');
            if (document.body.classList.contains('dark-theme')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                themeToggle.setAttribute('aria-label', 'Switch to light theme');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                themeToggle.setAttribute('aria-label', 'Switch to dark theme');
            }
        });

        // Toggle key visibility
        toggleKeyVisibility.addEventListener('click', () => {
            const isPassword = encryptKey.type === 'password';
            encryptKey.type = isPassword ? 'text' : 'password';
            toggleKeyVisibility.querySelector('i').classList.toggle('fa-eye');
            toggleKeyVisibility.querySelector('i').classList.toggle('fa-eye-slash');
            toggleKeyVisibility.setAttribute('aria-label', isPassword ? 'Hide key' : 'Show key');
        });

        // Generate random key
        generateKeyBtn.addEventListener('click', () => {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=';
            let key = '';
            for (let i = 0; i < 32; i++) {
                key += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            encryptKey.value = key;
            updateKeyStrength();
            encryptBtn.disabled = !encryptFiles.length || !isValidKey();
        });

        // Copy key to clipboard
        copyEncryptKeyBtn.addEventListener('click', () => {
            if (!encryptKey.value) {
                showAlert('Please generate or enter a key first', 'error');
                return;
            }
            navigator.clipboard.writeText(encryptKey.value)
                .then(() => showAlert('Key copied to clipboard!', 'success'))
                .catch(() => showAlert('Failed to copy key', 'error'));
        });

        // Key strength indicator
        encryptKey.addEventListener('input', () => {
            updateKeyStrength();
            encryptBtn.disabled = !encryptFiles.length || !isValidKey();
        });

        function updateKeyStrength() {
            const key = encryptKey.value;
            if (key.length < 8) {
                keyStrength.className = 'key-strength weak';
            } else if (key.length < 12) {
                keyStrength.className = 'key-strength medium';
            } else {
                const hasSpecial = /[!@#$%^&*()_+\-=]/.test(key);
                const hasNumbers = /\d/.test(key);
                const hasLetters = /[a-zA-Z]/.test(key);
                keyStrength.className = `key-strength ${hasSpecial && hasNumbers && hasLetters ? 'strong' : 'medium'}`;
            }
        }

        function isValidKey() {
            return encryptKey.value.length >= 8;
        }

        // File drop area handling
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            encryptDropArea.addEventListener(eventName, preventDefaults, false);
            decryptDropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            encryptDropArea.addEventListener(eventName, () => encryptDropArea.classList.add('active'), false);
            decryptDropArea.addEventListener(eventName, () => decryptDropArea.classList.add('active'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            encryptDropArea.addEventListener(eventName, () => encryptDropArea.classList.remove('active'), false);
            decryptDropArea.addEventListener(eventName, () => decryptDropArea.classList.remove('active'), false);
        });

        // Keyboard support for drag-and-drop
        [encryptDropArea, decryptDropArea].forEach(area => {
            area.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    area.querySelector('.file-input').click();
                }
            });
        });

        // Handle dropped files
        encryptDropArea.addEventListener('drop', (e) => handleEncryptFiles(e.dataTransfer.files));
        decryptDropArea.addEventListener('drop', (e) => handleDecryptFiles(e.dataTransfer.files));

        // Handle clicked files
        encryptDropArea.addEventListener('click', () => encryptFileInput.click());
        encryptFileInput.addEventListener('change', () => handleEncryptFiles(encryptFileInput.files));
        decryptDropArea.addEventListener('click', () => decryptFileInput.click());
        decryptFileInput.addEventListener('change', () => handleDecryptFiles(decryptFileInput.files));

        // Handle encrypt files
        function handleEncryptFiles(files) {
            encryptFiles = Array.from(files).filter(file => file.size <= MAX_FILE_SIZE);
            if (!encryptFiles.length) {
                showAlert('No valid files selected or files exceed 100MB', 'error');
                return;
            }
            if (files.length !== encryptFiles.length) {
                showAlert('Some files were ignored (exceed 100MB)', 'warning');
            }
            encryptFileInfo.innerHTML = encryptFiles.map(file => `
                <p><strong>File:</strong> ${file.name}</p>
                <p><strong>Size:</strong> ${formatFileSize(file.size)}</p>
            `).join('');
            encryptFileInfo.classList.add('show');
            encryptBtn.disabled = !isValidKey();
        }

        // Handle decrypt files
        function handleDecryptFiles(files) {
            if (files.length > 1) {
                showAlert('Please upload one file at a time for decryption', 'error');
                return;
            }
            decryptFile = files[0];
            if (decryptFile.size > MAX_FILE_SIZE) {
                showAlert('File exceeds 100MB limit', 'error');
                return;
            }
            decryptFileInfo.innerHTML = `
                <p><strong>Selected file:</strong> ${decryptFile.name}</p>
                <p><strong>Size:</strong> ${formatFileSize(decryptFile.size)}</p>
            `;
            decryptFileInfo.classList.add('show');
            updateDecryptButtonState();
        }

        // Update decrypt button state
        function updateDecryptButtonState() {
            decryptBtn.disabled = !decryptFile || !decryptKey.value;
        }

        // Add input listener for decrypt key
        decryptKey.addEventListener('input', updateDecryptButtonState);

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Read file in chunks
        async function readFileInChunks(file, asText = false) {
            const chunks = [];
            let offset = 0;
            while (offset < file.size) {
                const slice = file.slice(offset, offset + CHUNK_SIZE);
                const chunk = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    if (asText) {
                        reader.readAsText(slice);
                    } else {
                        reader.readAsArrayBuffer(slice);
                    }
                });
                chunks.push(chunk);
                offset += CHUNK_SIZE;
            }
            if (asText) {
                return chunks.join('');
            }
            const totalLength = chunks.reduce((sum, chunk) => sum + chunk.byteLength, 0);
            const combined = new Uint8Array(totalLength);
            let position = 0;
            for (const chunk of chunks) {
                combined.set(new Uint8Array(chunk), position);
                position += chunk.byteLength;
            }
            return combined.buffer;
        }

        // Simulate progress
        function simulateProgress(progressBar, callback) {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(interval);
                    callback();
                }
            }, 100);
        }

        // Encrypt files
        encryptBtn.addEventListener('click', async () => {
            if (!encryptFiles.length) {
                showAlert('Please select at least one file', 'error');
                return;
            }
            if (!isValidKey()) {
                showAlert('Please enter a key with at least 8 characters', 'error');
                return;
            }

            encryptProgressContainer.style.display = 'block';
            encryptProgressBar.style.width = '0%';
            encryptBtn.disabled = true;
            encryptedBlobs = [];

            try {
                const zip = new JSZip();
                for (const file of encryptFiles) {
                    const arrayBuffer = await readFileInChunks(file);
                    await new Promise((resolve, reject) => {
                        worker.onmessage = (e) => {
                            if (e.data.error) {
                                reject(new Error(`Encryption failed for ${e.data.fileName}: ${e.data.error}`));
                            } else {
                                const blob = new Blob([e.data.result], { type: 'application/octet-stream' });
                                encryptedBlobs.push({ blob, name: `${file.name.replace(/\.[^/.]+$/, '')}_encrypted.aes` });
                                zip.file(encryptedBlobs[encryptedBlobs.length - 1].name, blob);
                                resolve();
                            }
                        };
                        worker.postMessage({
                            fileData: arrayBuffer,
                            key: encryptKey.value,
                            action: 'encrypt',
                            mimeType: file.type,
                            fileName: file.name
                        });
                    });
                }

                // Update UI
                simulateProgress(encryptProgressBar, () => {
                    encryptResult.classList.add('show');
                    document.getElementById('encryptSuccessMsg').textContent = 
                        `${encryptFiles.length} file${encryptFiles.length > 1 ? 's' : ''} encrypted successfully!`;
                    
                    // Prepare download
                    downloadEncryptedBtn.onclick = async () => {
                        const zipBlob = await zip.generateAsync({ type: 'blob' });
                        const url = URL.createObjectURL(zipBlob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'encrypted_files.zip';
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(() => {
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        }, 100);
                    };
                    
                    showAlert('Files encrypted successfully!', 'success');
                    encryptBtn.disabled = false;
                    encryptProgressContainer.style.display = 'none';
                });
            } catch (error) {
                console.error('Encryption error:', error);
                showAlert(error.message || 'Error encrypting files', 'error');
                encryptBtn.disabled = false;
                encryptProgressContainer.style.display = 'none';
            }
        });

        // Decrypt file
        decryptBtn.addEventListener('click', async () => {
            if (!decryptFile) {
                showAlert('Please select a file first', 'error');
                return;
            }
            if (!decryptKey.value) {
                showAlert('Please enter the decryption key', 'error');
                return;
            }

            decryptProgressContainer.style.display = 'block';
            decryptProgressBar.style.width = '0%';
            decryptBtn.disabled = true;
            decryptErrorAlert.style.display = 'none';
            decryptSuccessAlert.style.display = 'flex';

            try {
                const encryptedData = await readFileInChunks(decryptFile, true);
                const result = await new Promise((resolve, reject) => {
                    worker.onmessage = (e) => {
                        if (e.data.error) {
                            reject(new Error(e.data.error));
                        } else {
                            resolve(e.data);
                        }
                    };
                    worker.postMessage({
                        fileData: encryptedData,
                        key: decryptKey.value,
                        action: 'decrypt'
                    });
                });

                // Create Blob from decrypted binary data
                decryptedBlob = new Blob([result.result], { type: result.mimeType });

                // Update UI
                simulateProgress(decryptProgressBar, () => {
                    decryptResult.classList.add('show');
                    document.getElementById('decryptSuccessMsg').textContent = 
                        `${result.fileName} decrypted successfully!`;
                    
                    // Prepare download
                    downloadDecryptedBtn.onclick = () => {
                        const url = URL.createObjectURL(decryptedBlob);
                        const a = document.createElement('a');
                        a.href = url;
                        let originalName = result.fileName;
                        if (!originalName) {
                            originalName = decryptFile.name.replace('_encrypted.aes', '');
                            if (originalName === decryptFile.name) {
                                originalName = 'decrypted_' + originalName;
                            }
                        }
                        a.download = originalName;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(() => {
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        }, 100);
                    };
                    
                    showAlert('File decrypted successfully!', 'success');
                    decryptBtn.disabled = false;
                    decryptProgressContainer.style.display = 'none';
                });
            } catch (error) {
                console.error('Decryption error:', error);
                decryptErrorAlert.style.display = 'flex';
                decryptSuccessAlert.style.display = 'none';
                document.getElementById('decryptErrorMsg').textContent = 
                    error.message || 'Error decrypting file';
                showAlert(error.message || 'Error decrypting file', 'error');
                decryptBtn.disabled = false;
                decryptProgressContainer.style.display = 'none';
            }
        });

        // Show alert message
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.setAttribute('role', 'alert');
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                alert.style.opacity = '0';
                setTimeout(() => {
                    alertContainer.removeChild(alert);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
